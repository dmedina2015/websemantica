<!DOCTYPE html>
<html>
<head lang="en">
<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
<link rel="stylesheet" type="text/css" href="css/main.css">
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">

<title>Moviefy - O que vamos ver hoje?</title>
</head>
<body>
<nav class="navbar navbar-expand-md">
  <a class="navbar-brand" href="#">
  	<figure>
  		<img src="images/MoviefyLogoTransparent.png" alt="moviefy" class="navbar-logo">	
  	</figure>
  </a>
  <button class="navbar-toggler navbar-dark" type="button" data-toggle="collapse" data-target="#main-navigation">
    <span class="navbar-toggler-icon"></span>
  </button>
  <div class="collapse navbar-collapse" id="main-navigation">
    <ul class="navbar-nav">
      <li class="nav-item">
        <a class="nav-link" href="http://moviefy.ddns.net:8081/moviefyFE">Home</a>
      </li>
      <li class="nav-item">
        <a class="nav-link" href="#">About</a>
      </li>
      <li class="nav-item">
        <a class="nav-link" href="#">Contact</a>
      </li>
    </ul>
  </div>
</nav>

<header class="page-header header container-fluid">
	<div class="overlay">
		<div id="landingPage" class="description">
			<h1>Posso te ajudar?</h1>
		  	<p>O Moviefy é seu consultor particular para a escolha de filmes. Através de seu histórico de visualizações do Netflix, ele irá inferir suas preferências e sugerir os filmes que provavelmente te deixarão grudado no sofá!</p>
		  	<form action="upload" id="netflixForm" name="netflixForm" method="post" enctype="multipart/form-data">
				<p>Selecione seu Histórico de Visualizações do Netflix e clique em Enviar:</p><input type="file" name="file" id="file" size="50"/> 
				<input type="submit" id="btnSubmit" value="Enviar"/>
		   	</form>
		</div>
		<div id="results">
	
		
		</div>
	</div>
</header>



<div id="loadingModal" class="modal"><!-- Place at bottom of page --></div>



 <!-- load jQuery library -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.2.4/jquery.min.js"></script>
    <script>
        $(document).ready(function () {
            // evento de "submit"
            $("#btnSubmit").click(function (event) {
                // parar o envio para que possamos faze-lo manualmente.
                event.preventDefault();
                // capture o formulário
                var form = $('#netflixForm')[0];
                // crie um FormData {Object}
                var data = new FormData(form);
                // caso queira adicionar um campo extra ao FormData
                // data.append("customfield", "Este é um campo extra para teste");
                // desabilitar o botão de "submit" para evitar multiplos envios até receber uma resposta
                $("#btnSubmit").prop("disabled", true);
                // processar
                $.ajax({
                    type: "POST",
                    enctype: 'multipart/form-data',
                    url: "upload",
                    data: data,
                    processData: false, // impedir que o jQuery tranforma a "data" em querystring
                    contentType: false, // desabilitar o cabeçalho "Content-Type"
                    cache: false, // desabilitar o "cache"
                    timeout: 600000, // definir um tempo limite (opcional)
                    // manipular o sucesso da requisição
                    success: function (data) {
                        console.log(data);
                        document.getElementById("landingPage").style.display = "none";
                        
                        document.getElementById('results').innerHTML += data;
                        // reativar o botão de "submit"
                        $("#btnSubmit").prop("disabled", false);
                    },
                    // manipular erros da requisição
                    error: function (e) {
                        console.log(e);
                        // reativar o botão de "submit"
                        $("#btnSubmit").prop("disabled", false);
                    }
                });
            });
        });
    </script>
    
    
<script type="text/javascript">
$body = $("body");

$(document).on({
    ajaxStart: function() { $body.addClass("loading");    },
     ajaxStop: function() { $body.removeClass("loading"); }    
});

$(document).ready(function() {
    $('#submit_btn').click(function(){
        $(document).ajaxStart();
    });//end click
});//end rdy
</script>
<!-- <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js" integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo" crossorigin="anonymous"></script> -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js" integrity="sha384-UO2eT0CpHqdSJQ6hJty5KVphtPhzWj9WO1clHTMGa3JDZwrnQq4sF86dIHNDz0W1" crossorigin="anonymous"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js" integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM" crossorigin="anonymous"></script>
<script src="script/main.js"></script>
</body>
</html>